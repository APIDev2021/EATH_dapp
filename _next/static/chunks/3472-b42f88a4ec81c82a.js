"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3472],{5543:function(e,t,n){n.d(t,{y:function(){return C}});var r=n(52322),a=n(2784),i=n(63955),o=n(67810),s=n(88883),l=n(4814),u=n(95666),c=n(98217),d=n(30195),m=n(22021),h=n(50338),p=n(40284),f=n(17482),v=n(14441),g=n(6813),x=n(51328),y=n(69793),b=n(40051),j=n(78780),w=n(63470),D=n(94855);let k=e=>{let{grant:t}=e,n=(0,f.R)(t.authorization.spend_limit.denom);return(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsx)(o.kL,{address:t.granter,disableTooltip:!0}),"\xa0",(0,r.jsx)("small",{className:"text-muted-foreground",children:"|"}),"\xa0",(0,r.jsx)(D.J,{uakt:(0,b.XS)(t.authorization.spend_limit)}),"\xa0",null==n?void 0:n.label,"\xa0",(0,r.jsxs)("small",{className:"text-muted-foreground",children:["(Exp:\xa0",(0,r.jsx)(w.Ji,{value:new Date(t.expiration)}),")"]})]})},A=d.z.object({amount:d.z.coerce.number({invalid_type_error:"Amount must be a number."}).min(1e-6,{message:"Amount is required."}),useDepositor:d.z.boolean().optional(),depositorAddress:d.z.string().optional()}).refine(e=>!e.useDepositor||!!e.depositorAddress,{message:"Depositor address is required.",path:["depositorAddress"]}),C=e=>{let{handleCancel:t,onDeploymentDeposit:n,disableMin:d,denom:w,infoText:D=null}=e,C=(0,a.useRef)(null),{settings:z}=(0,m.r)(),{enqueueSnackbar:N}=(0,c.Ds)(),[S,Z]=(0,a.useState)(""),[_,E]=(0,a.useState)(!1),{walletBalances:I,address:F}=(0,h.O)(),{data:L}=(0,v.Vb)(F),O=(0,f.R)(w),Q=(0,i.cI)({defaultValues:{amount:0,useDepositor:!1,depositorAddress:""},resolver:(0,s.F)(A)}),{handleSubmit:B,control:K,watch:P,setValue:R,clearErrors:G,unregister:T}=Q,{amount:U,useDepositor:W,depositorAddress:M}=P(),V=(0,p.NV)(),Y=(null==L?void 0:L.filter(e=>1!==(0,l.Z)(new Date,new Date(e.expiration))&&e.authorization.spend_limit.denom===w))||[];async function H(e){E(!0);try{var t;let n=await fetch("".concat(z.apiEndpoint,"/cosmos/authz/v1beta1/grants?granter=").concat(M,"&grantee=").concat(F)),r=await n.json(),a=null===(t=r.grants)||void 0===t?void 0:t.find(e=>"/akash.deployment.v1beta2.DepositDeploymentAuthorization"===e.authorization["@type"]||"/akash.deployment.v1beta3.DepositDeploymentAuthorization"===e.authorization["@type"]);if(!a)return Z("You are not authorized by this depositor."),!1;let i=new Date(a.expiration);if(1===(0,l.Z)(new Date,i))return Z("Authorization expired since ".concat(i.toDateString())),!1;let o=(0,b.XS)(a.authorization.spend_limit);if(e>o)return Z("Spend limit remaining: ".concat((0,y.zL)(o)," ").concat(null==O?void 0:O.label)),!1;return!0}catch(e){return console.error(e),N((0,r.jsx)(o.A9,{title:e.message,iconVariant:"error"}),{variant:"error"}),!1}finally{E(!1)}}(0,a.useEffect)(()=>{O&&0===U&&!d&&R("amount",(null==O?void 0:O.min)||0)},[O]),(0,a.useEffect)(()=>{G(),Z(""),W||(R("depositorAddress",""),T("depositorAddress"))},[W]);let J=()=>{t()},q=()=>{G(),R("amount",(null==O?void 0:O.inputMax)||0)},X=async e=>{let{amount:t,depositorAddress:r}=e;Z(""),G();let a=(0,y.Y2)(t),i=(null==I?void 0:I.uakt)||0,o=(null==I?void 0:I.usdc)||0;if(!d&&t<((null==O?void 0:O.min)||0)){Z("Deposit amount must be greater or equal than ".concat(null==O?void 0:O.min,"."));return}if(W){if(!await H(a))return;(0,u.B)(g._.USE_DEPOSITOR,{category:"deployments",label:"Use depositor to deposit in deployment"})}else if(w===x.Dn&&a>i){Z("You can't deposit more than you currently have in your balance. Current balance is: ".concat((0,b.Yk)(i)," AKT."));return}else if(w===V&&a>o){Z("You can't deposit more than you currently have in your balance. Current balance is: ".concat((0,y.zL)(o)," USDC."));return}n(a,r)};return(0,r.jsx)(o.GI,{fullWidth:!0,open:!0,variant:"custom",actions:[{label:"Cancel",color:"primary",variant:"ghost",side:"left",onClick:J},{label:"Continue",color:"secondary",variant:"default",side:"right",disabled:!U||_||W&&0===Y.length,isLoading:_,onClick:e=>{var t;e.preventDefault(),null===(t=C.current)||void 0===t||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}}],onClose:J,maxWidth:"xs",enableCloseOnBackdropClick:!0,title:"Deployment Deposit",children:(0,r.jsx)(o.l0,{...Q,children:(0,r.jsxs)("form",{onSubmit:B(X),ref:C,children:[D,(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(o.Wi,{control:K,name:"amount",render:e=>{let{field:t}=e;return(0,r.jsx)(o.yt,{...t,type:"number",label:(0,r.jsxs)("div",{className:"mb-1 flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Amount"}),(0,r.jsxs)(j.e,{onClick:()=>q(),className:"text-xs",children:["Balance: ",null==O?void 0:O.balance," ",null==O?void 0:O.label]})]}),autoFocus:!0,min:d?0:null==O?void 0:O.min,step:1e-6,max:null==O?void 0:O.inputMax,startIcon:(0,r.jsx)("div",{className:"pl-2 text-xs",children:null==O?void 0:O.label})})}})}),(0,r.jsx)("div",{className:"my-4 flex items-center",children:(0,r.jsx)(i.Qr,{control:K,name:"useDepositor",render:e=>{let{field:t}=e;return(0,r.jsx)(o.$B,{label:"Use another address to fund",checked:t.value,onCheckedChange:t.onChange})}})}),W&&(0,r.jsx)(o.Wi,{control:K,name:"depositorAddress",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.xJ,{className:"mt-2 w-full",children:[(0,r.jsx)(o.lX,{htmlFor:"deposit-grantee-address",children:"Address"}),(0,r.jsxs)(o.OC,{value:t.value||"",onValueChange:t.onChange,disabled:0===Y.length,children:[(0,r.jsx)(o.i4,{id:"deposit-grantee-address",children:(0,r.jsx)(o.ki,{placeholder:0===Y.length?"No available grants":"Select address"})}),(0,r.jsx)(o.Bw,{children:(0,r.jsx)(o.DI,{children:Y.map(e=>(0,r.jsx)(o.Ql,{value:e.granter,children:(0,r.jsx)(k,{grant:e})},e.granter))})})]}),(0,r.jsx)(o.zG,{})]})}}),S&&(0,r.jsx)(o.bZ,{variant:"destructive",className:"mt-4 text-sm",children:S})]})})})}},94855:function(e,t,n){n.d(t,{J:function(){return c}});var r=n(52322),a=n(2784),i=n(5638),o=n(63470),s=n(54302),l=n(69793);let u=()=>(0,r.jsx)("span",{className:"ml-1 text-sm font-normal",children:"AETH"}),c=e=>{let{uakt:t,showUSD:n,showAKTLabel:c,digits:d=6,notation:m}=e,{isLoaded:h,aktToUSD:p}=(0,s.t)(),f=(0,l.zL)(t,6);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Hf,{value:f,maximumFractionDigits:d,minimumFractionDigits:d,notation:m,children:e=>(0,r.jsx)(r.Fragment,{children:e.map((e,t)=>{switch(e.type){case"integer":case"group":return(0,r.jsx)("b",{children:e.value},t);case"decimal":case"fraction":return(0,r.jsx)("small",{className:"text-secondary-foreground",children:e.value},t);default:return(0,r.jsx)(a.Fragment,{children:e.value},t)}})})}),c&&(0,r.jsx)(u,{}),h&&n&&f>0&&(0,r.jsxs)("small",{className:"text-secondary-foreground",children:["\xa0(",(0,r.jsx)(o.BK,{style:"currency",currency:"USD",value:p(f)||0,notation:"compact"}),")"]})]})}},78780:function(e,t,n){n.d(t,{e:function(){return i}});var r=n(52322);n(2784);var a=n(49158);function i(e){let{children:t,className:n="",...i}=e;return(0,r.jsx)("button",{type:"button",...i,className:(0,a.cn)(n,"m-0 inline-flex cursor-pointer border-0 bg-transparent p-0 text-primary underline visited:text-primary-visited disabled:cursor-default disabled:text-gray-500"),children:t})}},48332:function(e,t,n){n.d(t,{BH:function(){return b},Ke:function(){return k},MZ:function(){return v},UP:function(){return m},_o:function(){return c},mv:function(){return x},p3:function(){return p},wi:function(){return w}});var r=n(82066),a=n(87066),i=n(67155),o=n(51328),s=n(40905),l=n(94590);async function u(e){return e?(await a.Z.get(i.ig.providerDetail(e))).data:null}function c(e,t){return(0,r.useQuery)(l.i.getProviderDetailKey(e),()=>u(e),t)}async function d(e){if(!e)return null;try{let t=await a.Z.post(o.Me,{url:"".concat(e,"/status"),method:"GET"}),n=await a.Z.post(o.Me,{url:"".concat(e,"/version"),method:"GET"});return(0,s.OH)(t.data,(null==n?void 0:n.data)||{})}catch(e){throw console.log(e),e}}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.useQuery)(l.i.getProviderStatusKey(e),()=>d(e),t)}async function h(){let e=await a.Z.get(i.ig.networkCapacity());return(0,s.Hy)(e.data)}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useQuery)(l.i.getNetworkCapacity(),()=>h(),e)}async function f(){return(await a.Z.get(i.ig.auditors())).data}function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useQuery)(l.i.getAuditorsKey(),()=>f(),{...e,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1})}async function g(e){return(await a.Z.get(i.ig.providerActiveLeasesGraph(e))).data}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.useQuery)(l.i.getProviderActiveLeasesGraph(e),()=>g(e),t)}async function y(){return(await a.Z.get(i.ig.providerAttributesSchema())).data}function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useQuery)(l.i.getProviderAttributesSchema(),()=>y(),{...e,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1})}async function j(){return(await a.Z.get(i.ig.providerList())).data}function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useQuery)(l.i.getProviderListKey(),()=>j(),e)}async function D(){return(await a.Z.get(i.ig.providerRegions())).data}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useQuery)(l.i.getProviderRegionsKey(),()=>D(),e)}}}]);