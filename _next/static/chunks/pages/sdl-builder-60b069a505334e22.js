(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2006],{15945:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sdl-builder",function(){return l(72600)}])},75536:function(e,t,l){"use strict";l.d(t,{P:function(){return o}});var r=l(52322);l(2784);var s=l(67810),i=l(39097),a=l.n(i),n=l(22761);let o=e=>{let{message:t}=e;return(0,r.jsxs)(s.bZ,{children:[t,", please"," ",(0,r.jsx)(a(),{href:n.iO.login(),passHref:!0,children:"login"})," ","or"," ",(0,r.jsx)(a(),{href:n.iO.signup(),passHref:!0,children:"register"}),"."]})}},72600:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return G}});var r=l(52322),s=l(2784),i=l(22103),a=l(63955),n=l(67810),o=l(88883),c=l(87066),u=l(86394),d=l(68901),v=l(37164),m=l(39097),p=l.n(m),f=l(82876),h=l(95666),x=l(98217),b=l(86499),j=(e,t)=>{let{storage:l,watch:r,setValue:i,exclude:a=[],onDataRestored:n,validate:o=!1,dirty:c=!1,touch:u=!1,onTimeout:d,timeout:v,defaultValues:m}=t,p=r(),f=()=>l||window.sessionStorage,h=()=>f().removeItem(e);return(0,s.useEffect)(()=>{let t=f().getItem(e),l=t?JSON.parse(t):m;if(l){let{_timestamp:e=null,...t}=l,r={},s=Date.now();if(v&&s-e>v){d&&d(),h();return}Object.keys(t).forEach(e=>{a.includes(e)||(r[e]=t[e],i(e,t[e],{shouldValidate:o,shouldDirty:c,shouldTouch:u}))}),n&&n(r)}},[l,e,n,i,m]),(0,s.useEffect)(()=>{let t=a.length?Object.entries(p).filter(e=>{let[t]=e;return!a.includes(t)}).reduce((e,t)=>{let[l,r]=t;return Object.assign(e,{[l]:r})},{}):Object.assign({},p);Object.entries(t).length&&(void 0!==v&&(t._timestamp=Date.now()),f().setItem(e,JSON.stringify(t)))},[p,v]),{clear:()=>f().removeItem(e)}},g=l(67899),y=l(50766),C=l(8046),S=l(47397),w=l(6813),_=l(51328),k=l(52904),L=l(85636),D=l(24006),E=l(22761),O=l(79534),N=l(89159),P=l(38617),I=l(14822);let T=e=>{let{onClose:t,setValue:l}=e,[i,a]=(0,s.useState)(""),[o,c]=(0,s.useState)(null),{enqueueSnackbar:u}=(0,x.Ds)(),{resolvedTheme:d}=(0,P.F)();(0,s.useEffect)(()=>{let e=(0,I.B)(500);return e.start().then(()=>{v(i||"")}),()=>{e&&e.abort()}},[i]);let v=e=>{try{if(!e)return null;let t=(0,D.Z)(e);return c(null),t}catch(e){"YAMLException"===e.name||"CustomValidationError"===e.name?c(e.message):"TemplateValidation"===e.name?c(e.message):(c("Error while parsing SDL file"),console.error(e))}};return(0,r.jsxs)(n.GI,{fullWidth:!0,open:!0,variant:"custom",title:"Import SDL",actions:[{label:"Close",color:"primary",variant:"text",side:"left",onClick:t},{label:"Import",color:"secondary",variant:"default",side:"right",disabled:!i||!!o,onClick:()=>{let e=v(i||"");e&&(l("services",e),u((0,r.jsx)(n.A9,{title:"Import success!",iconVariant:"success"}),{variant:"success",autoHideDuration:4e3}),(0,h.B)(w._.IMPORT_SDL,{category:"sdl_builder",label:"Import SDL"}),t())}}],onClose:t,maxWidth:"md",enableCloseOnBackdropClick:!0,children:[(0,r.jsxs)("h6",{className:"mb-4 flex items-center text-muted-foreground",children:["Paste your sdl here to import ",(0,r.jsx)(N.Z,{className:"ml-4 text-sm"})]}),(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsx)(O.default,{height:"500px",defaultLanguage:"yaml",value:i,onChange:e=>a(e),theme:"dark"===d?"vs-dark":"light"})}),o&&(0,r.jsx)(n.bZ,{className:"mt-4",variant:"destructive",children:o})]})};var B=l(50973),V=l(11956);let Z=e=>{let{sdl:t,onClose:l}=e,{resolvedTheme:s}=(0,P.F)(),{enqueueSnackbar:i}=(0,x.Ds)();return(0,r.jsxs)(n.GI,{fullWidth:!0,open:!0,variant:"custom",title:"Preview SDL",actions:[{label:"Close",color:"primary",variant:"text",side:"right",onClick:l}],onClose:l,maxWidth:"md",enableCloseOnBackdropClick:!0,children:[(0,r.jsx)("div",{className:"mb-4 flex items-center",children:(0,r.jsxs)(n.zx,{color:"secondary",variant:"default",onClick:()=>{(0,V.T)(t),i((0,r.jsx)(n.A9,{title:"SDL copied to clipboard!",iconVariant:"success"}),{variant:"success",autoHideDuration:3e3})},size:"sm",children:["Copy the SDL",(0,r.jsx)(B.Z,{className:"ml-2 text-sm"})]})}),(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsx)(O.default,{height:"500px",defaultLanguage:"yaml",value:t,theme:"dark"===s?"vs-dark":"light"})})]})};var A=l(30195),z=l(75536),R=l(69529),W=l(69687),M=l(69774);let F=A.z.object({title:A.z.string().min(3,"Title must be at least 3 characters long"),visibility:A.z.enum(["private","public"])}),U=e=>{let{onClose:t,getTemplateData:l,templateMetadata:i,setTemplateMetadata:c,services:u}=e,[d,v]=(0,s.useState)([]),{enqueueSnackbar:m}=(0,x.Ds)(),p=(0,s.useRef)(null),{user:f,isLoading:b}=(0,R.W)(),j=!b&&!f,g=!j&&(null==f?void 0:f.sub)===(null==i?void 0:i.userId),{mutate:y}=(0,M.DZ)(!g),C=(0,a.cI)({defaultValues:{title:"",visibility:"private"},resolver:(0,o.F)(F)}),{handleSubmit:S,control:_,setValue:k}=C;(0,s.useEffect)(()=>{v(u.some(e=>{var t;return null===(t=e.env)||void 0===t?void 0:t.some(e=>!e.isSecret)})?u.reduce((e,t)=>{var l;return e.concat([...null===(l=t.env)||void 0===l?void 0:l.filter(e=>!e.isSecret)])},[]):[]),i&&g&&(k("title",i.title),k("visibility",i.isPublic?"public":"private"))},[]);let L=async e=>{let s=l();await y({...s,title:e.title,isPublic:"private"!==e.visibility});let a={...i,title:e.title,isPublic:"private"!==e.visibility};g||(a.username=f.username||"",a.userId=f.sub||""),c(a),m((0,r.jsx)(n.A9,{title:"Template saved!",iconVariant:"success"}),{variant:"success"}),a.id?(0,h.B)(w._.UPDATE_SDL_TEMPLATE,{category:"sdl_builder",label:"Update SDL template"}):(0,h.B)(w._.CREATE_SDL_TEMPLATE,{category:"sdl_builder",label:"Create SDL template"}),t()};return(0,r.jsx)(n.GI,{fullWidth:!0,open:!0,variant:"custom",title:"Save Template",actions:[{label:"Cancel",color:"primary",variant:"text",side:"left",onClick:t},{label:g?"Save":"Save As",color:"secondary",variant:"default",side:"right",disabled:j,onClick:()=>{var e;null===(e=p.current)||void 0===e||e.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}}],onClose:t,maxWidth:"xs",enableCloseOnBackdropClick:!0,children:(0,r.jsx)("div",{className:"pt-2",children:j?(0,r.jsx)(z.P,{message:"To save a template"}):(0,r.jsx)(n.l0,{...C,children:(0,r.jsxs)("form",{onSubmit:S(L),ref:p,autoComplete:"off",children:[(0,r.jsx)(n.Wi,{control:_,name:"title",render:e=>{let{field:t}=e;return(0,r.jsx)(n.yt,{type:"text",label:"Title",className:"mb-4 w-full",value:t.value||"",onChange:e=>t.onChange(e.target.value)})}}),(0,r.jsx)(n.Wi,{control:_,name:"visibility",render:e=>{let{field:t}=e;return(0,r.jsxs)(n.Ee,{defaultValue:"private",value:t.value,onValueChange:t.onChange,className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(n.mJ,{value:"private",id:"private"}),(0,r.jsx)(n.__,{htmlFor:"private",children:"Private"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(n.mJ,{value:"public",id:"public"}),(0,r.jsx)(n.__,{htmlFor:"public",children:"Public"})]})]})}}),d.length>0&&(0,r.jsxs)(n.bZ,{variant:"warning",className:"mt-4 max-h-[150px] overflow-y-auto",children:["You have ",d.length," public environment variables. Are you sure you don't need to hide them as secret?",(0,r.jsx)("ul",{className:"break-all p-0",children:d.map((e,t)=>(0,r.jsxs)("li",{children:[e.key,"=",(0,W.x)(e.value,30)]},t))})]})]})})})})},H={services:[{...k.ss}]},J=()=>{let[e,t]=(0,s.useState)(null),[l,i]=(0,s.useState)(null),[m,O]=(0,s.useState)([]),[N,P]=(0,s.useState)(!1),[I,B]=(0,s.useState)(!1),[V,A]=(0,s.useState)(!1),[z,R]=(0,s.useState)(!1),[W,M]=(0,s.useState)(null),F=(0,s.useRef)(null),[,J]=(0,d.KO)(y.Z.deploySdl),[K,Y]=(0,d.KO)(y.Z.sdlBuilderSdl),{data:G}=(0,g.P)(),{enqueueSnackbar:X}=(0,x.Ds)(),$=(0,a.cI)({resolver:(0,o.F)(C.Yf)}),{handleSubmit:q,reset:Q,control:ee,trigger:et,watch:el,setValue:er}=$;j("sdl-builder-form",{watch:el,setValue:er,defaultValues:H,storage:window.localStorage});let{fields:es,remove:ei,append:ea}=(0,a.Dq)({control:ee,name:"services",keyName:"id"}),{services:en}=el(),eo=(0,f.useRouter)(),ec=(0,f.useSearchParams)(),eu=null==ec?void 0:ec.get("id");(0,s.useEffect)(()=>{K&&K.services&&er("services",K.services)},[]),(0,s.useEffect)(()=>{eu&&!l||eu&&(null==l?void 0:l.id)!==eu?ed(eu):!eu&&l&&(i(null),Q())},[eu,l]),(0,s.useEffect)(()=>{en&&Y({services:en})},[en]);let ed=async e=>{try{P(!0);let t=(await c.Z.get("/api/proxy/user/template/".concat(e))).data,l=(0,D.Z)(t.sdl);P(!1),Q(),er("services",l),O(l.map((e,t)=>t)),i(t)}catch(e){X((0,r.jsx)(n.A9,{title:"Error fetching template.",iconVariant:"error"}),{variant:"error"}),P(!1)}},ev=e=>{ei(e)},em=async e=>{t(null);try{let t=(0,L.C)(e.services);J({title:"",category:"",code:"",description:"",content:t}),eo.push(E.iO.newDeployment({step:_.Qr.editDeployment})),(0,h.B)(w._.DEPLOY_SDL,{category:"sdl_builder",label:"Deploy SDL from create page"})}catch(e){t(e.message)}},ep=async()=>{await et()&&B(!0)};return(0,r.jsxs)(r.Fragment,{children:[V&&(0,r.jsx)(T,{onClose:()=>A(!1),setValue:er}),z&&(0,r.jsx)(Z,{onClose:()=>R(!1),sdl:W||""}),I&&(0,r.jsx)(U,{onClose:()=>B(!1),getTemplateData:()=>{let e=(0,L.C)(en);return{id:(null==l?void 0:l.id)||void 0,sdl:e,cpu:null==en?void 0:en.map(e=>{var t;return 1e3*((null===(t=e.profile)||void 0===t?void 0:t.cpu)||0)}).reduce((e,t)=>e+t,0),ram:null==en?void 0:en.map(e=>{var t;let l=S._8.find(t=>{var l;return t.suffix===(null===(l=e.profile)||void 0===l?void 0:l.ramUnit)});return((null===(t=e.profile)||void 0===t?void 0:t.ram)||0)*((null==l?void 0:l.value)||0)}).reduce((e,t)=>e+t,0),storage:null==en?void 0:en.map(e=>{var t,l,r;let s=S.rk.find(t=>{var l;return t.suffix===(null===(l=e.profile)||void 0===l?void 0:l.ramUnit)}),i=S.rk.find(t=>{var l;return t.suffix===(null===(l=e.profile)||void 0===l?void 0:l.persistentStorageUnit)});return((null===(t=e.profile)||void 0===t?void 0:t.storage)||0)+((null==s?void 0:s.value)||0)+((null===(l=e.profile)||void 0===l?void 0:l.hasPersistentStorage)?((null===(r=e.profile)||void 0===r?void 0:r.persistentStorage)||0)+((null==i?void 0:i.value)||0):0)}).reduce((e,t)=>e+t,0)}},templateMetadata:l,setTemplateMetadata:i,services:en}),(0,r.jsx)(n.l0,{...$,children:(0,r.jsxs)("form",{onSubmit:q(em),ref:F,autoComplete:"off",children:[l&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("p",{children:[l.title,"\xa0by\xa0",l.username&&(0,r.jsx)("span",{onClick:()=>{(0,h.B)(w._.CLICK_SDL_PROFILE,{category:"sdl_builder",label:"Click on SDL user profile"})},children:(0,r.jsx)(p(),{href:E.iO.userProfile(l.username),children:l.username})})]}),(0,r.jsx)("div",{className:"ml-6",children:(0,r.jsxs)(p(),{href:E.iO.template(eu),className:"inline-flex cursor-pointer items-center",onClick:()=>{(0,h.B)(w._.CLICK_VIEW_TEMPLATE,{category:"sdl_builder",label:"Click on view SDL template"})},children:["View template ",(0,r.jsx)(u.Z,{className:"ml-2 text-sm"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between pt-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(n.zx,{color:"secondary",variant:"default",type:"submit",children:"Deploy"}),(0,r.jsx)(n.zx,{color:"secondary",variant:"text",onClick:()=>{t(null);try{let e=(0,L.C)(en);M(e),R(!0),(0,h.B)(w._.PREVIEW_SDL,{category:"sdl_builder",label:"Preview SDL from create page"})}catch(e){t(e.message)}},className:"ml-4",type:"button",children:"Preview"}),(0,r.jsx)(n.zx,{color:"secondary",variant:"text",onClick:()=>A(!0),className:"ml-4",type:"button",children:"Import"}),(0,r.jsx)(n.zx,{variant:"text",className:"ml-4",type:"button",onClick:()=>{(0,h.B)(w._.RESET_SDL,{category:"sdl_builder",label:"Reset SDL"}),er("services",[{...k.ss}])},children:"Reset"}),N&&(0,r.jsx)("div",{className:"ml-4",children:(0,r.jsx)(n.$j,{size:"small"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)(n.zx,{color:"secondary",variant:"default",type:"button",onClick:()=>ep(),children:"Save"})})]}),null==en?void 0:en.map((e,t)=>(0,r.jsx)(b.$,{serviceIndex:t,_services:en,setValue:er,control:ee,trigger:et,onRemoveService:ev,serviceCollapsed:m,setServiceCollapsed:O,gpuModels:G},e.id)),e&&(0,r.jsx)(n.bZ,{variant:"destructive",className:"mt-4",children:e}),(0,r.jsx)("div",{className:"flex items-center justify-end pt-4",children:(0,r.jsx)("div",{children:(0,r.jsx)(n.zx,{color:"secondary",variant:"default",onClick:()=>{ea({...k.ss,id:(0,v.x0)(),title:"service-".concat(es.length+1)})},type:"button",children:"Add Service"})})})]})})]})};var K=l(36200),Y=l(42660),G=(0,l(40830).F0)()(function(){return(0,r.jsxs)(i.Z,{children:[(0,r.jsx)(K.T,{title:"SDL Builder",url:"".concat(E.OT).concat(E.iO.sdlBuilder()),description:"Build your own SDL configuration to deploy a docker container on the Aethernet, the #1 decentralized supercloud."}),(0,r.jsx)(Y.D,{children:"SDL Builder"}),(0,r.jsx)(J,{})]})})},89159:function(e,t,l){"use strict";l.d(t,{Z:function(){return d}});var r=l(2784),s=l(80073),i=Object.defineProperty,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,c=(e,t,l)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,u=(e,t)=>{for(var l in t||(t={}))n.call(t,l)&&c(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&c(e,l,t[l]);return e},d=(0,r.forwardRef)((e,t)=>{let l=u(u({},r.useContext(s.s)),e);return r.createElement("svg",u({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:t},l),r.createElement("path",{d:"M12 3L12 21M12 21L20.5 12.5M12 21L3.5 12.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))})},86394:function(e,t,l){"use strict";l.d(t,{Z:function(){return d}});var r=l(2784),s=l(80073),i=Object.defineProperty,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,c=(e,t,l)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,u=(e,t)=>{for(var l in t||(t={}))n.call(t,l)&&c(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&c(e,l,t[l]);return e},d=(0,r.forwardRef)((e,t)=>{let l=u(u({},r.useContext(s.s)),e);return r.createElement("svg",u({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:t},l),r.createElement("path",{d:"M9 6L15 12L9 18",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))})}},function(e){e.O(0,[2309,1864,8871,1588,5356,6432,4325,9534,309,1280,2888,9774,179],function(){return e(e.s=15945)}),_N_E=e.O()}]);